<!DOCTYPE html>
<html lang="en">
<head>
    <title>Covid Aware</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Covid Awareness Building Game" />
    <meta name="keywords" content="covid,awareness,pandemic,sorting,game" />
    <meta property="og:site_name" content="Covid Awareness" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Home | Covid Awareness | Gamify" />
    <meta property="og:url" content="https:///" />
    <meta property="og:description" content="Covid Awareness Building Game" />
    <meta property="og:updated_time" content="2020-06-27T12:58:50-04:00" />
  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.0.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="js/jquery.csv.min.js"></script>
    <style>
        .modal-dialog {
            background-color: rgba(0,0,0,.59) !important;
        }

        .wgBtnAsset img
        {
            -webkit-box-shadow: 10px 7px 21px 3px rgb(95, 95, 95);
            -moz-box-shadow: 10px 7px 21px 3px rgb(95, 95, 95);
            box-shadow: 10px 7px 21px 3px rgb(95, 95, 95); 
        }

        .wgBtnAssetHighlight img
        {
            border: 3px solid rgb(56, 255, 7);
            -webkit-box-shadow: 10px 7px 21px 0px rgb(128, 128, 128);
            -moz-box-shadow: 10px 7px 21px 0px rgb(128, 128, 128);
            box-shadow: 10px 7px 21px 0px rgb(128, 128, 128); 
        }

        .wgQuestionBox
        {
            padding: 7px;
            -webkit-box-shadow: 10px 7px 21px 3px rgba(230,230,230,1);
            -moz-box-shadow: 10px 7px 21px 3px rgba(230,230,230,1);
            box-shadow: 10px 7px 21px 3px rgba(230,230,230,1); 
        }
    </style>
</head>
<body>
    <div class="container-fluid" style="background-image: linear-gradient(#8debfc,#bfeff8, #FEFEFE,#9ec9dd, rgb(77, 207, 17));">
        <div class="row">
            <div class="col-sm-12" style="height: 93vh">
                <!--ROW 1-->
                <div class="row" style="height: 20vh; margin-top: 15px">
                    <div class="col-sm-12" style="text-align: center">
                        <h1><span id="lblScore" class="badge badge-primary">Score: <span id="curscore">0</span> <span id="totalqs"></span></span></h1>
                    </div>
                </div>

                <!--ROW 2-->
                <div class="row" style="height: 30vh">
                    <div class="col-sm-12" id="cardQuestionBox" style="text-align: center">
                        
                        <div class="card" id="" style="width: 18rem; position: relative; display: inline-block">
                            <div class="card-body">
                                <h2><span id="oneQuestionResult"></span></h2>
                            </div>
                        </div>
                        <br/>

                        <div class="card" style="width: 25rem; position: relative; display: inline-block">                            
                            <div class="card-body" id="outerQuestionBox">
                              <h5 class="card-title">Question: </h5>
                              <p class="card-text wgQuestionBox" id="displayItem">Questions Will Appear Here.</p>
                              <!--<a href="#" class="btn btn-primary">Go somewhere</a>-->
                            </div>
                            <div class="card-body" id="playAgainBox" style="display: none">
                                <h5 class="card-title">Game Over</h5>
                                
                                <a href="#" class="btn btn-primary" id="btnPlayAgain">Play Again?</a>
                              </div>
                          </div>
                    </div>
                </div>

                <!--ROW 3-->
                <div class="row">
                    <div class="col-1"></div>
                    <div class="col-2 wgBtnAsset" id="asset1" data-assettype="1"><h4><span class="badge badge-success">Green Zone</span></h4><img src="images/covid-prevent.svg" /></div>
                    <div class="col-2 wgBtnAsset" id="asset2" data-assettype="2"><h4><span class="badge badge-warning">Yellow Zone</span></h4><img src="images/covid-protect.svg" /></div>
                    <div class="col-2 wgBtnAsset" id="asset3" data-assettype="3"><h4><span class="badge badge-warning" style="background-color: rgb(224, 146, 0)">Orange Zone</span></h4><img src="images/covid-restrict.svg" /></div>
                    <div class="col-2 wgBtnAsset" id="asset4" data-assettype="4"><h4><span class="badge badge-danger">Red Zone</span></h4><img src="images/covid-control.svg" /></div>
                    <div class="col-2 wgBtnAsset" id="asset5" data-assettype="5"><h4><span class="badge badge-secondary">Grey Zone</span></h4><img src="images/covid-lockdown.svg" /></div>
                    <div class="col-2"></div>
                    
                </div>
                

            </div>
        </div>

        <footer class="page-footer font-small blue pt-4">
            <div class=class="footer-copyright text-center py-3">
                Â© 2020 Copyright: Covid Aware, Covid Awareness Building Game. 
            </div>
        </footer>

            <!------------[Dialogs]----------------->
    <div id="myModal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="dialogTitle"></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p id="dialogBody">Modal body text goes here.</p>
            </div>
            <div class="modal-footer">
              
              <button id="dialogBtnClose" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button id="dialogBtnPlay" type="button" class="btn btn-secondary" data-dismiss="modal">Play</button>
            </div>
          </div>
        </div>
      </div>
</body>
</html>

<script type="text/javascript">
    var _jsShowQuestionsCount = 5;
    var _jsFileItems = [];
    var _displayQuestionsArr = [];
    var _jsScore = 0;
    var _jsTurnCount = 0;

    $(document).ready(function(){

        console.log("Initial Definition of the Items");
        $(".wgBtnAsset").css({"cursor":"pointer"});
        
        showWelcomeDialog();
        $("#dialogBtnPlay, #btnPlayAgain").click(function(e){
            startGame();
        })
        
        $(".wgBtnAsset").click(clickBin);


    });//(End Of) Document.ready

    function startGame()
    {                
        $(".wgBtnAsset").fadeIn("fast");
        $("#outerQuestionBox").fadeIn("fast");
        $("#playAgainBox").hide();
        _jsTurnCount = 0;
        _jsScore = 0;
        //update score board
        $("#curscore").html(_jsScore);
        $("#totalqs").html("");

        readDataFromTxtFiles("allItems.txt");
    }

    

    function showWelcomeDialog()
    {
        //set the welcome text
        $("#dialogBody").html("<h2>Covid Aware</h2><br/><h4>A Covid Awareness Building Game</h4>");

        //hide the close button
        $("#dialogBtnClose").hide();

        //show modal
        $('#myModal').modal('show');

    }//(End Of) Function showWelcomeDialog()



    function clickBin(e)
    {
        //e.preventDefault();
        //remove all handlers so that users cannot click on it again while we are showing it
        $(".wgBtnAsset").off("click");
        console.log("Asset clicked");
        
        var element = event.target.nodeName;
        var $binDiv = null;
        if(element=="DIV")
        {
            $binDiv = $(e.target);
        }
        else
        {
            $binDiv = $(e.target).closest("div");
        }
        console.log($binDiv.data())
        _jsTurnCount++;
        $("#turncount").html(_jsTurnCount);

        var typeArr =  $("#displayItem").data("type");
        var curAssetType = ""+$binDiv.data("assettype");
        console.log( $.inArray(curAssetType, typeArr));
        if( $.inArray(curAssetType, typeArr)  !=-1)
        {
            $("#oneQuestionResult").removeClass().addClass("badge badge-success").html("Correct");
            _jsScore ++ ;

        }
        else
        {
            $("#oneQuestionResult").removeClass().addClass("badge badge-danger").html("Wrong!");
        }
        
        //highlight the correct boxes
        HighlightBoxes(typeArr);
        $("#oneQuestionResult").show();

        //update score board
        $("#curscore").html(_jsScore);

        //hide it after 500ms
        setTimeout(function(){
            $("#oneQuestionResult").fadeOut("slow"); 
            displayNext();
            UnHighlightAllBoxes();
            
            //add all the click handlers back
            $(".wgBtnAsset").click(clickBin);
            
            }, 500);
        
        //_displayArr.splice(0, 1) ;
        
        
        //console.log($(e.target))
    }//(End Of) function

    function HighlightBoxes(paramBoxId)
    {
        $.each(paramBoxId, function(i, datax){

            $("#asset" + datax).removeClass("wgBtnAsset").addClass("wgBtnAssetHighlight");
            
        });
    }

    function UnHighlightAllBoxes()
    {

        $(".wgBtnAssetHighlight").removeClass("wgBtnAssetHighlight").addClass("wgBtnAsset");
            
    }

    function readDataFromTxtFiles(filename)
    {
        
        $.ajax({
            url:filename,
            type:'GET',
            dataType: "text",
            async: true,
            success: function(response)
            {
                _jsFileItems = $.csv.toArrays(response);
                //console.log(_jsFileItems);
                getRandomItems(_jsShowQuestionsCount);
            }
        });
        //console.log("filename: " + filename + "read complete");
        //console.log(arrayName);
        


    }//(End Of) function

    function getRandomItems(paramItemCount)
    {
        var fileItemsClone = _jsFileItems.slice();
        
        for(var i=0; i<paramItemCount; i++)
        {
            //console.log("i=" + i);
            var randomIndex = Math.floor(Math.random() * fileItemsClone.length);
            var valx = $.trim(fileItemsClone[randomIndex][0]);
            var typex = [];
            for(var m=1; m<fileItemsClone.length; m++)
            {
                typex.push($.trim(fileItemsClone[randomIndex][m]));            
            }
            
            var newGameQuestion = {type: typex, item: valx};
            _displayQuestionsArr.push(newGameQuestion);
            fileItemsClone.splice(randomIndex, 1);
            
        }

        //note, at this point, in the console, it will show one less item as the displayNext() function will splice it.
        //eventhough at this point there are 5 items in the array, but the console will show 4 and that is fine.
        console.log(_displayQuestionsArr);
        displayNext();
        
    }//(End Of) Function

    function displayNext()
    {
        //game ends if the length of questions array is 0 or less
        if(_displayQuestionsArr.length<=0)
        {
            $("#totalqs").html(" out of " + _jsShowQuestionsCount);
            $("#displayItem").html("End Game!");
            $("#displayItem").data("type", "");
            //show modal
            //$('#myModal').modal('show');
            $(".wgBtnAsset").fadeOut("fast");
            $("#outerQuestionBox").hide();
            $("#playAgainBox").fadeIn("fast");
            

            //getRandomItems(_jsShowQuestionsCount);
            return;
        }
        var nextIndex = 0;
        if(_displayQuestionsArr.length > 1)
        {
            nextIndex = Math.floor(Math.random() * _displayQuestionsArr.length); //generates a number from 0 to (1 less display array length)
            
            console.log(_displayQuestionsArr)
        }
        //console.log(nextIndex);
        //console.log(_displayArr);
        //$("#outerQuestionBox .card-title").html()
        $("#displayItem").html(_displayQuestionsArr[nextIndex].item);
        $("#displayItem").data("type", _displayQuestionsArr[nextIndex].type);
        //console.log(_displayArr)
        _displayQuestionsArr.splice(nextIndex,1);
    }//(End Of) Function

</script>